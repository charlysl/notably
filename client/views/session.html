<div id="session-container" class="page-container page-wrap">

  <nav-bar></nav-bar>

  <div class="content-container">
    <div class="row" id="session-header">
      <div id="session-header-container">
        <div class="left">
          <h4 ng-if="!session" class="thin-text" >
            <a class="btn-floating waves-effect waves-light" href="/">
              <i class="material-icons">arrow_back</i>
            </a>
              &nbsp; Session {{sessionId}}
          </h4>
          <h4 ng-if="session" class="thin-text" >
            <a class="btn-floating waves-effect waves-light" href="/course/{{session.meta.number}}">
              <i class="material-icons">arrow_back</i>
            </a>
            &nbsp;{{session.meta.number}}: {{session.meta.title}}
          </h4>
        </div>
        <div class="right view-selector">
          <input name="display" type="radio" id="left_option" ng-model="showOption" value="left" />
          <label for="left_option">Feed</label>
          <input name="display" type="radio" id="both_option" ng-model="showOption" value="both" />
          <label for="both_option">Both</label>
          <input name="display" type="radio" id="right_option"  ng-model="showOption" value="right" />
          <label for="right_option">Stash</label>
        </div>
      </div>
    </div>

    <div class="row feeds">
        <div ng-class="{true: 's12 m6', false: 's12'}[showOption === 'both']" class="col feeds-col" ng-hide="showOption === 'right'" >
        <div id="feed-container" class="card-panel card-primary">

        <div class="row" id="feed-header" class="thin-header">
          <div class="left thin-header">Feed</div>

          <div class="right valign-wrapper">
            <button class="toggle-flag-button tooltipped toggle-flag-button-active" data-position="left" data-delay="50" ng-show="showFlags" data-tooltip="Hide flagged snippets" ng-click="showFlags = !showFlags"><i class="material-icons">flag</i></button>
            <button class="toggle-flag-button tooltipped" data-position="left" data-delay="50" ng-hide="showFlags" data-tooltip="View flagged snippets" ng-click="showFlags = !showFlags"><i class="material-icons">flag</i></button>
        </div>
        </div>

        <div id="feed-view">
          <div class="thin-text" ng-if="!feed || feed.length === 0"><em>Add a snippet!</em></div>

          <div ng-repeat="snip in feed" ng-if="!(!showFlags && snip.flagCount - snip.saveCount > 0)">
            <div class="card snippet-card black-text collapsed-snippet" id="feed-snippet-{{ snip._id }}">
              <div class="card-content">
                <div class="snippet-header">
                  <div class="left">
                    <b ng-if="snip.author !== currentUser"><a ng-href="/profile/{{snip.author}}">{{snip.author}}</a></b>
                    <b ng-if="snip.author === currentUser"><a ng-href="/profile/{{snip.author}}" class="you-posted">you</a></b>
                    posted <em am-time-ago="snip.timestamp"></em>
                  </div>
                  <div class="right valign-wrapper">
                    <button class="snippet-button valign-wrapper expand-button" ng-show="isOverflowingFeed(snip._id)" ng-click="toggleSnippetFeed(snip._id)">
                      <div class="valign expand-button-text"> Show more </div> <i class="material-icons">expand_more</i>
                    </button>
                    <button class="snippet-button valign-wrapper expand-button" ng-show="hasOverflownFeed(snip._id)" ng-click="toggleSnippetFeed(snip._id)">
                    <div class="valign expand-button-text"> Show less </div> <i class="material-icons">expand_less</i>
                    </button>
                    {{snip.saveCount}}
                    <button
                        class="save-button snippet-button"
                        ng-class="{false: 'save-button snippet-button', true: 'save-button snippet-button save-button-active'}[alreadySaved[snip._id]]"
                        ng-disabled="alreadySaved[snip._id]"
                        ng-click="saveSnippet(snip._id)"
                        id="feed-save-{{ snip._id }}">
                        <i class="material-icons">star</i>
                    </button>
                    {{snip.flagCount}}
                    <button
                        class="flag-button snippet-button"
                        ng-class="{false: 'flag-button snippet-button', true: 'flag-button snippet-button flag-button-active'}[alreadyFlagged[snip._id]]"
                        ng-disabled="alreadySaved[snip._id] || currentUser === snip.author"
                        ng-click="flagSnippet(snip._id)"
                        id="feed-flag-{{ snip._id }}">
                        <i class="material-icons">flag</i>
                    </button>
                  </div>
                </div>
                 <br/>
                <p class="black-text markdown-parsed" ng-bind-html="snip.text"></p>
              </div>
            </div>
          </div>
        </div>

        </div>
        </div>
        <div ng-class="{true: 's12 m6', false: 's12'}[showOption === 'both']" class="col feeds-col"  ng-hide="showOption === 'left'" id="printarea">
          <div id="stash-container" class="card-panel card-primary">
          <div class="row card-title" id="stash-header">
            <div class="left thin-header">Your Stash</div>

            <div class="right valign-wrapper">
              <a class="print-button tooltipped" data-position="left" data-delay="50" data-tooltip="Print view" ng-href="/stash/{{session.stash._id}}"><i class="material-icons">print</i></a>
            </div>
          </div>


          <div id="stash-view">
            <div class="thin-text" ng-if="!stash || stash.length === 0"><em>Your stash is empty!</em></div>

            <div ng-repeat="snip in stash | orderBy:'timestamp'">
              <div  class="card snippet-card black-text collapsed-snippet" id="stash-snippet-{{ snip._id }}">
                <div class="card-content">
                  <div class="snippet-header">
                    <div class="left">
                       <b ng-if="snip.author !== currentUser"><a ng-href="/profile/{{snip.author}}">{{snip.author}}</a></b>
                       <b ng-if="snip.author === currentUser"><a ng-href="/profile/{{snip.author}}" class="you-posted">you</a></b>
                       posted <em am-time-ago="snip.timestamp"></em>
                    </div>
                    <div class="right valign-wrapper">
                      <button class="snippet-button valign-wrapper expand-button" ng-show="isOverflowingStash(snip._id)" ng-click="toggleSnippetStash(snip._id)">
                        <div class="valign expand-button-text"> Show more </div> <i class="material-icons">expand_more</i>
                      </button>
                      <button class="snippet-button valign-wrapper expand-button" ng-show="hasOverflownStash(snip._id)" ng-click="toggleSnippetStash(snip._id)">
                      <div class="valign expand-button-text"> Show less </div> <i class="material-icons">expand_less</i>
                      </button>
                      {{snip.saveCount}}
                      <button
                        class="save-button snippet-button save-button-active"
                        ng-click="saveSnippet(snip._id)"
                        id="stash-save-{{ snip._id }}" disabled>
                        <i class="material-icons">star</i>
                      </button>
                      {{snip.flagCount}}
                      <button
                        class="flag-button snippet-button"
                        ng-click="flagSnippet(snip._id)"
                        ng-class="{false: 'flag-button snippet-button', true: 'flag-button snippet-button flag-button-active'}[alreadyFlagged[snip._id]]"
                        id="stash-flag-{{ snip._id }}" disabled>
                        <i class="material-icons">flag</i>
                      </button>
                      <button class="remove-button snippet-button" ng-click="removeSnippet(snip._id)"><i class="material-icons">clear</i></button>
                    </div>
                  </div>
                   <br/>
                  <p class="black-text markdown-parsed" ng-bind-html="snip.text"></p>
                </div>
              </div>
            </div>
          </div>

      </div>
      </div>
    </div>

    <div id="sticky-submit-spacer" ng-if="showNotes"></div>
    <div id="sticky-submit-spacer-small" ng-if="!showNotes"></div>

    <div class="submit" id="sticky-submit">
      <div class="card-panel" id="snippet-input-container">
        <div id="submit-header" class="center-align" >
        <button class="snippet-button valign-wrapper expand-button-submit" ng-click="showNotes = !showNotes">
          <div class="valign expand-button-submit-text"  ng-show="showNotes"> Hide editor </div> <i class="material-icons" ng-show="showNotes">expand_more</i>
          <div class="valign expand-button-submit-text"  ng-show="!showNotes"> Show editor </div> <i class="material-icons"  ng-show="!showNotes">expand_less</i>
        </button>
        </div>
          <div class="card submit-area left-align" ng-show="showNotes">
            <textarea placeholder="Enter notes here..." id="snippet-input-area" ng-model="snippetInput" ng-show="!preview" required> </textarea>
            <div ng-bind-html="previewText" id="snippet-preview" class="markdown-parsed" ng-if="preview"> </div>
            <div id="submit-sidebar">
            <button ng-click="togglePreview()" class="btn-floating light-blue accent-2" id="toggle-preview-button">
                <i class="material-icons small" ng-if="preview">mode_edit</i>
                <i class="material-icons small" ng-if="!preview">remove_red_eye</i>
            </button>
            <br/>
            <button ng-click="addSnippet()" ng-disabled="!session" class="btn-floating  green lighten-2">
                <i class="material-icons small">send</i>
            </button>
            </div>
          </div>
      </div>
    </div>
  </div>
</div>
